<div class="row">
  <div id="breadcrumb" class="col-md-12">
    <ol class="breadcrumb">
      <li><a href="index.html">Home</a></li>
      <li><a href="#">Activity Log</a></li>
    </ol>
  </div>
</div>
<h3 class="page-header">Activity Log</h3>
<div class="row">
  <div class="col-xs-12">
    <div class="box">
      <div class="box-header">
        <div class="box-name">
          <i class="fa fa-linux"></i>
          <span>Timeline events (logical order)</span>
        </div>
        <div class="box-icons">
          <a class="collapse-link">
            <i class="fa fa-chevron-up"></i>
          </a>
          <a class="expand-link">
            <i class="fa fa-expand"></i>
          </a>
          <a class="close-link">
            <i class="fa fa-times"></i>
          </a>
        </div>
        <div class="no-move"></div>
      </div>
      <div class="box-content no-padding table-responsive">
        <table class="table table-bordered table-striped table-hover table-heading table-datatable" id="datatable-2">
          <thead>
            <tr>
              <th><label>Order number</label></th>
              <th><label>Timestamp</label></th>
              <th><label>Node</label></th>              
              <th><label>Kind</label></th>
              <th><label>Info</label></th>
            </tr>
          </thead>
          <tbody id="list_of_platform_activities">
          <!--
            <tr>
              <td>1</td>
              <td>led-gateway</td>
              <td>20150421-145700</td>
              <td>Node discovered</td>
              <td>Node UUID 1234-5678-9010-3546</td>
            </tr>           
          -->
          </tbody>
          <!--
          <tfoot>
            <tr>
              <th>Order number</th>
              <th>Node</th>
              <th>Timestamp</th>
              <th>Kind</th>
              <th>Info</th>
            </tr>
          </tfoot>
          -->
        </table>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">

var activities_lastupdate = 0.00;

function loadActivities() {
    $.getJSON( "/admin/api/v1/platform/activities", function( data ) {            
        frame = "";
        for (var i in data['activities']) {

          var order = data['activities'][i]['order'];
          var node = data['activities'][i]['node'];
          var timestamp = data['activities'][i]['timestamp'];
          var kind = data['activities'][i]['kind'];
          var info = data['activities'][i]['info'];
          
          frame += "<tr>";
          frame += "    <td>"+order+"</td>";          
          frame += "    <td>"+timestamp+"</td>";
          frame += "    <td>"+node+"</td>";
          frame += "    <td>"+kind+"</td>";
          frame += "    <td>"+info+"</td>";
          frame += "</tr>";
          
        } 
        $('#list_of_platform_activities').html(frame);        
        activities_lastupdate = data['meta']['lastupdate'];
    });
}

function refresh() {
  setTimeout(refresh, 2000);
  $.getJSON("/admin/api/v1/platform/activities/lastupdate", function(data) {
    var result = data['meta']['lastupdate'];
      if (result > activities_lastupdate) {
        activities_lastupdate = result;
        loadActivities();        
      }
  }); 
}

$(document).ready(function() {
    loadActivities();
    setTimeout(refresh, 2000);

});
</script>

